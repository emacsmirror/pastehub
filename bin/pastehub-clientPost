#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require 'net/http'
require 'uri'
require 'open-uri'
require 'fileutils'
require 'pastehub'
PasteHub::Config.instance.loadClient

def main
  username  = ENV['PASTEHUB_USER']
  if not username 
    STDERR.puts( "clientSync needs environment var `PASTEHUB_USER'" )
    exit 1
  end

  secretKey = ENV['PASTEHUB_SECRET_KEY']
  if not secretKey
    STDERR.puts( "clientSync needs environment var `PASTEHUB_SECRET_KEY'" )
  end
  
  data = STDIN.read
  auth = PasteHub::AuthForClient.new( username, secretKey )  
  client = PasteHub::Client.new( auth )
  if client.online?(  )
    key = client.postData( data )
    puts client.localSaveValue( key, data ) # sync single entry now.
  else
    puts client.localSaveValue( nil, data )
  end
end

main
