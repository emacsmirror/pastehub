#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require 'net/http'
require 'uri'
require 'open-uri'
require 'fileutils'
require 'pastehub'
PasteHub::Config.instance.loadClient

def main
  username  = PasteHub.loadUsername
  if not username
    STDERR.puts "clientPost: setup problem. Please setup pastehub application."
    exit 1
  end

  # save to LocalDB
  data = STDIN.read
  auth = PasteHub::AuthForClient.new( username, "" )
  client = PasteHub::Client.new( auth )
  puts client.localSaveValue( nil, data )

  # singal to pastehubSync
  pid = PasteHub.loadPid
  pp ["pid", pid ]
  if 0 < pid
    Process.kill( :SIGUSR1, pid )
  end
end

main
